<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EU Motivation — EUreka!</title>

  <!-- External Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { getFirestore, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVv0Ag4-i3h0bEEYOiX4pRCZF7a4_a220",
      authDomain: "eureka-63b47.firebaseapp.com",
      projectId: "eureka-63b47",
      storageBucket: "eureka-63b47.firebasestorage.app",
      messagingSenderId: "655168214317",
      appId: "1:655168214317:web:3d3ffc07706ba39efa6fa4",
      measurementId: "G-KFTB45DCFZ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.firebaseFns = { auth, db, doc, updateDoc, arrayUnion, onAuthStateChanged };
  </script>
</head>
<body id="eu-motivation-page">

  <!-- Page Header -->
  <header class="page-header">
    <div class="header-left">
      <h1>EU Motivation</h1>
      <p>Practice motivation & fit questions for working at the European Commission.</p>
    </div>
    <div class="header-right">
      <a href="index.html" class="back-home">Back to Homepage</a>
    </div>
  </header>

  <!-- Main Card -->
  <main class="card">
    <div id="question" class="question">Click "Next Question" to start</div>

    <div class="controls">
      <button id="nextBtn">Next Question</button>
      <button id="shuffleBtn">Shuffle</button>
      <button id="copyBtn">Copy</button>
    </div>

    <div class="status">
      <span id="counter">0 / 0</span>
      <span id="timer">00:00</span>
    </div>

    <section id="self-assessment">
      <h2>Submit Your Self-Assessment</h2>
      <form id="assessment-form">
        <label>Clarity (1–5): <input type="number" id="clarity" min="1" max="5" required></label>
        <label>Structure (1–5): <input type="number" id="structure" min="1" max="5" required></label>
        <label>Confidence (1–5): <input type="number" id="confidence" min="1" max="5" required></label>
        <button type="submit">Submit Score</button>
      </form>
      <p id="form-status"></p>
    </section>
  </main>

  <!-- Scripts -->
  <script src="EUreka-base.js"></script>
  <script type="module" src="EUmotivation.js"></script>

  <script type="module">
    const { auth, db, doc, updateDoc, arrayUnion, onAuthStateChanged } = window.firebaseFns;
    const form = document.getElementById("assessment-form");
    const status = document.getElementById("form-status");

    let currentUser = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        status.textContent = "";
      } else {
        currentUser = null;
        status.textContent = "Please log in on the main page to submit scores.";
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentUser) {
        status.textContent = "You must be logged in!";
        return;
      }

      const clarity = parseInt(document.getElementById("clarity").value);
      const structure = parseInt(document.getElementById("structure").value);
      const confidence = parseInt(document.getElementById("confidence").value);

      const submission = {
        clarity,
        structure,
        confidence,
        timestamp: new Date().toISOString()
      };

      try {
        const userDoc = doc(db, "users", currentUser.uid);
        await updateDoc(userDoc, {
          "selfAssessment.EUmotivation": arrayUnion(submission)
        });
        status.textContent = "Score submitted successfully!";
        form.reset();
      } catch (err) {
        console.error(err);
        status.textContent = "Error submitting score: " + err.message;
      }
    });
  </script>

</body>
</html>
