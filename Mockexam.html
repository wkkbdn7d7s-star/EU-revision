<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECi Mock Exam</title>

  <!-- Shared global styles (back arrow, fonts) -->
  <link rel="stylesheet" href="EUreka-base.css">

  <!-- Module-specific styles -->
  <link rel="stylesheet" href="Mockexam.css">
</head>
<body>
  <!-- Back arrow -->
  <a href="index.html" class="back-arrow" title="Back to homepage">‚Üê</a>

  <div class="container">
    <header class="page-header">
      <h1>Mock Exam</h1>
      <p>Simulate a full EU interview practice with Knowledge, Competency, and Motivation questions.</p>
    </header>

    <main class="card">
      <div id="content">
        <p>Click "Start Mock Exam" to begin the simulation.</p>
        <div class="controls">
          <button id="startBtn">Start Mock Exam</button>
        </div>
      </div>

      <div class="status">
        <span id="timer">00:00</span>
      </div>
    </main>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDVv0Ag4-i3h0bEEYOiX4pRCZF7a4_a220",
      authDomain: "eureka-63b47.firebaseapp.com",
      projectId: "eureka-63b47",
      storageBucket: "eureka-63b47.firebasestorage.app",
      messagingSenderId: "655168214317",
      appId: "1:655168214317:web:e7d928bc5c1ea525fa6fa4",
      measurementId: "G-4ZJBL0203J"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Track current user
    let currentUser = null;
    onAuthStateChanged(auth, user => {
      currentUser = user; // null if logged out
    });

    // Make Firestore globally accessible
    window.db = db;
    window.addDoc = addDoc;
    window.collection = collection;
    window.currentUser = currentUser;
  </script>

  <!-- Mock Exam JS -->
  <script src="Mockexam.js"></script>

  <!-- Self-assessment injection after mock ends -->
  <script>
    function showSelfAssessmentForm() {
      const content = document.getElementById('content');
      const timerEl = document.getElementById('timer');

      content.innerHTML = `
        <h2>Mock Exam Complete üéâ</h2>
        <p>Great job! Please rate your overall performance (1‚Äì10):</p>
        <div style="margin: 20px 0;">
          <input id="scoreInput" type="number" min="1" max="10" placeholder="Enter score (1‚Äì10)" style="padding: 10px; border-radius: 8px; width: 120px; text-align: center; font-size: 1.1em;">
        </div>
        <div class="controls">
          <button id="submitScoreBtn">Submit</button>
        </div>
        <p id="feedbackMsg" style="margin-top: 20px; font-weight: bold;"></p>
      `;

      timerEl.textContent = "";

      const submitBtn = document.getElementById("submitScoreBtn");
      const scoreInput = document.getElementById("scoreInput");
      const feedbackMsg = document.getElementById("feedbackMsg");

      submitBtn.addEventListener("click", async () => {
        if (!window.currentUser) {
          feedbackMsg.textContent = "‚ö†Ô∏è Please log in to save your score.";
          feedbackMsg.style.color = "orange";
          return;
        }

        const score = parseInt(scoreInput.value.trim());
        if (isNaN(score) || score < 1 || score > 10) {
          feedbackMsg.textContent = "‚ö†Ô∏è Please enter a valid score between 1 and 10.";
          feedbackMsg.style.color = "orange";
          return;
        }

        try {
          await addDoc(collection(db, "users", window.currentUser.uid, "mockScores"), {
            score,
            timestamp: new Date().toISOString()
          });
          feedbackMsg.textContent = "‚úÖ Thank you! Your score has been recorded.";
          feedbackMsg.style.color = "lightgreen";
          scoreInput.disabled = true;
          submitBtn.disabled = true;
        } catch (err) {
          console.error("Error saving score:", err);
          feedbackMsg.textContent = "‚ùå Error saving your score. Please try again later.";
          feedbackMsg.style.color = "red";
        }
      });
    }

    window.showSelfAssessmentForm = showSelfAssessmentForm;
  </script>

</body>
</html>
